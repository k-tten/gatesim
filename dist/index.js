/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/Component.ts":(e,t,s)=>{s.r(t),s.d(t,{Component:()=>i});var n=s("./src/Reified.ts");class i extends n.Reified{element;inputs=[];outputs=[];observers=new Map;chip;constructor(e,{x:t,y:s}={x:0,y:0}){super(),this.chip=e,this.element=n.html`
            <div class="component">
                <div class="component-inputs">
                    ${Array(this.chip.inputs).fill('<button class="component-input-button">I</button>').join("")}
                </div>
                <p class="component-name">${this.chip.name}</p>
                <div class="component-outputs">
                    ${Array(this.chip.outputs).fill('<button class="component-output-button">O</button>').join("")}
                </div>
            </div>
        `,this.inputs=Array.from(this.element.querySelectorAll(".component-input-button")),this.outputs=Array.from(this.element.querySelectorAll(".component-output-button")),this.inputs.forEach((e=>this.observers.set(e,new MutationObserver((()=>{const e=this.chip.evaluate(this.inputs.map((e=>e.classList.contains("activated"))));this.outputs.forEach(((t,s)=>{t.classList.toggle("activated",e[s])}))}))))),this.move(t,s)}attach(){super.attach(),this.inputs.forEach((e=>{this.observers.get(e).observe(e,{attributeFilter:["class"],attributes:!0})}))}detach(){super.detach(),this.observers.forEach((e=>e.disconnect()))}}},"./src/DraggingManager.ts":(e,t,s)=>{s.r(t),s.d(t,{DraggingManager:()=>n});class n{static#e=void 0;static#t={x:-1,y:-1,ox:-1,oy:-1,down:!1};static#s=new Map;static watch(e,t=e){e.dataset.watched="true";const s=t=>{this.#e=e,this.#e.dataset.dragged="true",this.#e.style.cursor="grabbing";const s=this.#e.getBoundingClientRect(),n=this.#e.parentElement?.getBoundingClientRect()??new DOMRect;this.#t.ox=t.clientX-s.left+n.left,this.#t.oy=t.clientY-s.top+n.top};t.addEventListener("mousedown",s,{capture:!0}),this.#s.set(t,s)}static forget(e){const t=this.#s.get(e);if(!t)throw new Error("Element is not currently being watched.");delete e.dataset.watched,e.removeEventListener("mousedown",t,{capture:!0}),this.#s.delete(e)}static listen(){document.body.addEventListener("mousemove",this.mousemove),window.addEventListener("mousedown",this.mousedown),window.addEventListener("mouseup",this.mouseup)}static deafen(){document.body.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mousedown",this.mousedown),window.removeEventListener("mouseup",this.mouseup)}static mousemove(e){this.#t.x=e.clientX,this.#t.y=e.clientY,this.#e&&(this.#e.style.left=this.#t.x-this.#t.ox+"px",this.#e.style.top=this.#t.y-this.#t.oy+"px")}static mousedown(e){this.#t.down=!0}static mouseup(){this.#e&&document.querySelectorAll('[data-dragged="true"]').forEach((e=>{delete e.dataset.dragged,e.style.cursor=""})),this.#t.down=!1,this.#t.x=-1,this.#t.y=-1,this.#t.ox=-1,this.#t.oy=-1,this.#e=void 0}static{this.mousemove=this.mousemove.bind(this),this.mousedown=this.mousedown.bind(this),this.mouseup=this.mouseup.bind(this)}}},"./src/Input.ts":(e,t,s)=>{s.r(t),s.d(t,{Input:()=>i});var n=s("./src/Reified.ts");class i extends n.Reified{element;constructor({x:e,y:t}={x:0,y:0}){super(),this.element=n.html`<button class="board-input">I</button>`,this.move(e,t)}click=()=>{this.element.classList.toggle("activated")};contextmenu=e=>{e.preventDefault(),this.element.classList.toggle("activated")};attach(){super.attach(),this.element.addEventListener("click",this.click),this.element.addEventListener("contextmenu",this.contextmenu)}detach(){super.detach(),this.element.removeEventListener("click",this.click)}}},"./src/MenuManager.ts":(e,t,s)=>{s.r(t),s.d(t,{MenuManager:()=>i});var n=s("./src/Reified.ts");class i{static#n=new Map;static use(e,t){const s=n.html`
            <div class="contextmenu">
                ${t.map((e=>Object.entries(e).map((([e,{label:t}])=>`<button class="${e}">${t}</button>`)).join(""))).join('<div class="br"></div>')}
            </div>
        `,i=new Map;t.forEach((e=>{Object.keys(e).forEach((t=>{s.querySelector("."+t).addEventListener("click",(()=>{e[t].callback.call(void 0)})),i.set(t,i)}))})),s.style.left="0px",s.style.top="0px",s.style.display="none",document.body.appendChild(s);const o=()=>{s.style.left="0px",s.style.top="0px",s.style.display="none"},r=e=>{e.preventDefault(),s.style.display="",s.style.left=e.clientX+"px",s.style.top=e.clientY+"px"},a=()=>{s.style.left="0px",s.style.top="0px",s.style.display="none"};e.addEventListener("mousedown",o),e.addEventListener("contextmenu",r),s.addEventListener("click",a),this.#n.set(e,{menu:s,clicks:i,listeners:{mousedown:o,contextmenu:r,click:a}})}static remove(e){const{menu:t,clicks:s,listeners:n}=this.#n.get(e)??{};if(!t||!s||!n)throw new Error("Elements are not being affected.");e.removeEventListener("mousedown",n.mousedown),e.removeEventListener("contextmenu",n.contextmenu),t.removeEventListener("click",n.click),Array.from(s).forEach((([e,s])=>t.querySelector("."+e).removeEventListener("click",s))),t.remove()}}},"./src/Output.ts":(e,t,s)=>{s.r(t),s.d(t,{Output:()=>i});var n=s("./src/Reified.ts");class i extends n.Reified{element;constructor({x:e,y:t}={x:0,y:0}){super(),this.element=n.html`<button class="board-output">O</button>`,this.move(e,t)}}},"./src/Reified.ts":(e,t,s)=>{function n(...e){const[t,...s]=e,n="string"==typeof t?t:t.reduce(((e,t,n)=>e+t+s[n]??""),"");return(new DOMParser).parseFromString(n,"text/html").body.childNodes[0]}s.r(t),s.d(t,{Reified:()=>i,html:()=>n});class i{static root=document.querySelector(".reified-root");move(e,t){this.element.style.left=e+"px",this.element.style.top=t+"px"}attach(){i.root.append(this.element)}detach(){this.element.remove()}}},"./src/WiringManager.ts":(e,t,s)=>{s.r(t),s.d(t,{Wiring:()=>i,WiringManager:()=>o});var n=s("./src/canvas.ts");class i{from;to;constructor(e,t){this.from=e,this.to=t,new MutationObserver((()=>{t.classList.toggle("activated",e.classList.contains("activated"))})).observe(e,{attributeFilter:["class"],attributes:!0})}}class o{static wires=[];static render(){const e=(0,n.useCanvas)();this.wires.forEach((t=>{const s=t.from.getBoundingClientRect(),n=t.to.getBoundingClientRect();e.strokeStyle=t.from.classList.contains("activated")?"#ff2626":"#dedede",e.lineWidth=5,e.lineJoin="round",e.beginPath(),e.moveTo(s.x+s.width/2,s.y+s.height/2),e.lineTo(n.x+n.width/2,n.y+n.height/2),e.closePath(),e.stroke()}))}}},"./src/canvas.ts":(e,t,s)=>{s.r(t),s.d(t,{useCanvas:()=>i});const n=document.querySelector("canvas").getContext("2d");function i(){return n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight,n}},"./src/chips.ts":(e,t,s)=>{s.r(t),s.d(t,{AndGate:()=>i,Chip:()=>n,NotGate:()=>r,OrGate:()=>o});class n{name;inputs;outputs;constructor(e,t,s){this.name=e,this.inputs=t,this.outputs=s}evaluate(e){return this.output(e)}}class i extends n{constructor(){super("AND",2,1)}output([e,t]){return[e&&t]}}class o extends n{constructor(){super("OR",2,1)}output([e,t]){return[e||t]}}class r extends n{constructor(){super("NOT",1,1)}output([e]){return[!e]}}}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{s.r(n);var e=s("./src/chips.ts"),t=s("./src/Component.ts"),i=s("./src/DraggingManager.ts"),o=s("./src/Input.ts"),r=s("./src/MenuManager.ts"),a=s("./src/Output.ts"),c=s("./src/Reified.ts"),u=s("./src/WiringManager.ts");const l=new o.Input({x:100,y:100}),d=new o.Input({x:100,y:200}),h=new t.Component(new e.AndGate,{x:300,y:150}),m=new a.Output({x:500,y:150}),p=new Set([l,d,h,m]);i.DraggingManager.listen(),p.forEach((e=>{e.attach(),e instanceof t.Component&&i.DraggingManager.watch(e.element,e.element.querySelector(".component-name"))})),u.WiringManager.wires.push(new u.Wiring(l.element,h.inputs[0])),u.WiringManager.wires.push(new u.Wiring(d.element,h.inputs[1])),u.WiringManager.wires.push(new u.Wiring(h.outputs[0],m.element)),r.MenuManager.use(c.Reified.root,[{"insert-chip":{label:"Insert chip",callback:()=>{}}},{"new-input":{label:"New input",callback:()=>{}},"new-output":{label:"New output",callback:()=>{}}},{"new-chip":{label:"New chip from diagram",callback:()=>{}}},{"save-as":{label:"Save as file",callback:()=>{}}}]),function e(){u.WiringManager.render(),requestAnimationFrame(e)}()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJtYXBwaW5ncyI6IjtxSEFHTyxNQUFNQSxVQUFzRCxFQUFBQyxRQUN0REMsUUFFQUMsT0FBUyxHQUNUQyxRQUFVLEdBRVZDLFVBQVksSUFBSUMsSUFFaEJDLEtBRVRDLFlBQVlELEdBQWtCLEVBQUVFLEVBQUMsRUFBRUMsR0FBZ0MsQ0FBRUQsRUFBRyxFQUFHQyxFQUFHLElBQzFFQyxRQUVBQyxLQUFLTCxLQUFPQSxFQUVaSyxLQUFLVixRQUFVLEVBQUFXLElBQUk7OztzQkFHTEMsTUFBTUYsS0FBS0wsS0FBS0osUUFBUVksS0FBSyxxREFBcURDLEtBQUs7OzRDQUVqRUosS0FBS0wsS0FBS1U7O3NCQUVoQ0gsTUFBTUYsS0FBS0wsS0FBS0gsU0FBU1csS0FBSyxzREFBc0RDLEtBQUs7OztVQUt2R0osS0FBS1QsT0FBU1csTUFBTUksS0FBS04sS0FBS1YsUUFBUWlCLGlCQUFpQiw0QkFDdkRQLEtBQUtSLFFBQVVVLE1BQU1JLEtBQUtOLEtBQUtWLFFBQVFpQixpQkFBaUIsNkJBRXhEUCxLQUFLVCxPQUFPaUIsU0FBU0MsR0FDakJULEtBQUtQLFVBQVVpQixJQUNYRCxFQUNBLElBQUlFLGtCQUFpQixLQUNqQixNQUFNQyxFQUFNWixLQUFLTCxLQUFLa0IsU0FBU2IsS0FBS1QsT0FBT3VCLEtBQUtDLEdBQU1BLEVBQUVDLFVBQVVDLFNBQVMsZ0JBRTNFakIsS0FBS1IsUUFBUWdCLFNBQVEsQ0FBQ1UsRUFBUUgsS0FDMUJHLEVBQU9GLFVBQVVHLE9BQU8sWUFBYVAsRUFBSUcsR0FBRyxHQUM5QyxPQUtkZixLQUFLb0IsS0FBS3ZCLEVBQUdDLEVBQ2pCLENBRUF1QixTQUNJdEIsTUFBTXNCLFNBRU5yQixLQUFLVCxPQUFPaUIsU0FBU0MsSUFDakJULEtBQUtQLFVBQVU2QixJQUFJYixHQUFPYyxRQUFRZCxFQUFPLENBQ3JDZSxnQkFBaUIsQ0FBQyxTQUNsQkMsWUFBWSxHQUNkLEdBRVYsQ0FFQUMsU0FDSTNCLE1BQU0yQixTQUVOMUIsS0FBS1AsVUFBVWUsU0FBU21CLEdBQU1BLEVBQUVDLGNBQ3BDLCtFQ2hFRyxNQUFNQyxFQUNUQyxjQUFrQkMsRUFFbEJELFNBQWdCLENBQ1pqQyxHQUFJLEVBQ0pDLEdBQUksRUFDSmtDLElBQUssRUFDTEMsSUFBSyxFQUNMQyxNQUFNLEdBR1ZKLFNBQWtCLElBQUlwQyxJQUV0Qm9DLGFBQWF4QyxFQUFzQjZDLEVBQVM3QyxHQUN4Q0EsRUFBUThDLFFBQVFDLFFBQVUsT0FFMUIsTUFBTUMsRUFBYUMsSUFDZnZDLE1BQUssRUFBV1YsRUFFaEJVLE1BQUssRUFBU29DLFFBQVFJLFFBQVUsT0FFaEN4QyxNQUFLLEVBQVN5QyxNQUFNQyxPQUFTLFdBRTdCLE1BQU1DLEVBQU8zQyxNQUFLLEVBQVM0Qyx3QkFFckJDLEVBQU83QyxNQUFLLEVBQVM4QyxlQUFlRix5QkFBMkIsSUFBSUcsUUFFekUvQyxNQUFLLEVBQU9nQyxHQUFLTyxFQUFFUyxRQUFVTCxFQUFLTSxLQUFPSixFQUFLSSxLQUM5Q2pELE1BQUssRUFBT2lDLEdBQUtNLEVBQUVXLFFBQVVQLEVBQUtRLElBQU1OLEVBQUtNLEdBQUcsRUFHcERoQixFQUFPaUIsaUJBQWlCLFlBQWFkLEVBQVcsQ0FBRWUsU0FBUyxJQUUzRHJELE1BQUssRUFBU1UsSUFBSXlCLEVBQVFHLEVBQzlCLENBRUFSLGNBQWN4QyxHQUNWLE1BQU1nRSxFQUFXdEQsTUFBSyxFQUFTc0IsSUFBSWhDLEdBRW5DLElBQUtnRSxFQUFVLE1BQU0sSUFBSUMsTUFBTSxrREFFeEJqRSxFQUFROEMsUUFBUUMsUUFFdkIvQyxFQUFRa0Usb0JBQW9CLFlBQWFGLEVBQVUsQ0FBRUQsU0FBUyxJQUU5RHJELE1BQUssRUFBU3lELE9BQU9uRSxFQUN6QixDQUVBd0MsZ0JBQ0k0QixTQUFTYixLQUFLTyxpQkFBaUIsWUFBYXBELEtBQUsyRCxXQUNqREMsT0FBT1IsaUJBQWlCLFlBQWFwRCxLQUFLc0MsV0FDMUNzQixPQUFPUixpQkFBaUIsVUFBV3BELEtBQUs2RCxRQUM1QyxDQUVBL0IsZ0JBQ0k0QixTQUFTYixLQUFLVyxvQkFBb0IsWUFBYXhELEtBQUsyRCxXQUNwREMsT0FBT0osb0JBQW9CLFlBQWF4RCxLQUFLc0MsV0FDN0NzQixPQUFPSixvQkFBb0IsVUFBV3hELEtBQUs2RCxRQUMvQyxDQUVBL0IsaUJBQWlCUyxHQUNidkMsTUFBSyxFQUFPSCxFQUFJMEMsRUFBRVMsUUFDbEJoRCxNQUFLLEVBQU9GLEVBQUl5QyxFQUFFVyxRQUVkbEQsTUFBSyxJQUNMQSxNQUFLLEVBQVN5QyxNQUFNUSxLQUFPakQsTUFBSyxFQUFPSCxFQUFJRyxNQUFLLEVBQU9nQyxHQUFLLEtBQzVEaEMsTUFBSyxFQUFTeUMsTUFBTVUsSUFBTW5ELE1BQUssRUFBT0YsRUFBSUUsTUFBSyxFQUFPaUMsR0FBSyxLQUVuRSxDQUVBSCxpQkFBaUJTLEdBQ2J2QyxNQUFLLEVBQU9rQyxNQUFPLENBQ3ZCLENBRUFKLGlCQUNROUIsTUFBSyxHQUNMMEQsU0FBU25ELGlCQUE4Qix5QkFBeUJDLFNBQVMrQixXQUM5REEsRUFBRUgsUUFBUUksUUFFakJELEVBQUVFLE1BQU1DLE9BQVMsRUFBRSxJQUkzQjFDLE1BQUssRUFBT2tDLE1BQU8sRUFFbkJsQyxNQUFLLEVBQU9ILEdBQUssRUFDakJHLE1BQUssRUFBT0YsR0FBSyxFQUVqQkUsTUFBSyxFQUFPZ0MsSUFBTSxFQUNsQmhDLE1BQUssRUFBT2lDLElBQU0sRUFFbEJqQyxNQUFLLE9BQVcrQixDQUNwQixRQUdJL0IsS0FBSzJELFVBQVkzRCxLQUFLMkQsVUFBVUcsS0FBSzlELE1BQ3JDQSxLQUFLc0MsVUFBWXRDLEtBQUtzQyxVQUFVd0IsS0FBSzlELE1BQ3JDQSxLQUFLNkQsUUFBVTdELEtBQUs2RCxRQUFRQyxLQUFLOUQsS0FDckMsdUZDaEdHLE1BQU0rRCxVQUFjLEVBQUExRSxRQUNkQyxRQUVUTSxhQUFZLEVBQUVDLEVBQUMsRUFBRUMsR0FBZ0MsQ0FBRUQsRUFBRyxFQUFHQyxFQUFHLElBQ3hEQyxRQUVBQyxLQUFLVixRQUFVLEVBQUFXLElBQUkseUNBRW5CRCxLQUFLb0IsS0FBS3ZCLEVBQUdDLEVBQ2pCLENBRUFrRSxNQUFRLEtBQ0poRSxLQUFLVixRQUFRMEIsVUFBVUcsT0FBTyxZQUFZLEVBRzlDOEMsWUFBZTFCLElBQ1hBLEVBQUUyQixpQkFFRmxFLEtBQUtWLFFBQVEwQixVQUFVRyxPQUFPLFlBQVksRUFHOUNFLFNBQ0l0QixNQUFNc0IsU0FFTnJCLEtBQUtWLFFBQVE4RCxpQkFBaUIsUUFBU3BELEtBQUtnRSxPQUM1Q2hFLEtBQUtWLFFBQVE4RCxpQkFBaUIsY0FBZXBELEtBQUtpRSxZQUN0RCxDQUVBdkMsU0FDSTNCLE1BQU0yQixTQUVOMUIsS0FBS1YsUUFBUWtFLG9CQUFvQixRQUFTeEQsS0FBS2dFLE1BQ25ELG1HQ3RCRyxNQUFNRyxFQUNUckMsU0FBbUIsSUFBSXBDLElBRXZCb0MsV0FBV3hDLEVBQXNCOEUsR0FDN0IsTUFBTUMsRUFBTyxFQUFBcEUsSUFBSTs7a0JBRVBtRSxFQUNHdEQsS0FBS3dELEdBQ0ZDLE9BQU9DLFFBQVFGLEdBQ1Z4RCxLQUFJLEVBQUVULEdBQVFvRSxZQUFhLGtCQUFrQnBFLE1BQVNvRSxlQUN0RHJFLEtBQUssTUFFYkEsS0FBSzs7VUFJWnNFLEVBQVMsSUFBSWhGLElBRW5CMEUsRUFBUTVELFNBQVM4RCxJQUNiQyxPQUFPSSxLQUFLTCxHQUFROUQsU0FBU29FLElBS3pCUCxFQUFLUSxjQUEyQixJQUFNRCxHQUFNeEIsaUJBQWlCLFNBSi9DLEtBQ1ZrQixFQUFPTSxHQUFLRSxTQUFTQyxVQUFLaEQsRUFBVSxJQUt4QzJDLEVBQU9oRSxJQUFJa0UsRUFBS0YsRUFBTyxHQUN6QixJQUdOTCxFQUFLNUIsTUFBTVEsS0FBTyxNQUNsQm9CLEVBQUs1QixNQUFNVSxJQUFNLE1BQ2pCa0IsRUFBSzVCLE1BQU11QyxRQUFVLE9BRXJCdEIsU0FBU2IsS0FBS29DLFlBQVlaLEdBRTFCLE1BQU0vQixFQUFZLEtBQ2QrQixFQUFLNUIsTUFBTVEsS0FBTyxNQUNsQm9CLEVBQUs1QixNQUFNVSxJQUFNLE1BQ2pCa0IsRUFBSzVCLE1BQU11QyxRQUFVLE1BQU0sRUFHekJmLEVBQWUxQixJQUNqQkEsRUFBRTJCLGlCQUVGRyxFQUFLNUIsTUFBTXVDLFFBQVUsR0FDckJYLEVBQUs1QixNQUFNUSxLQUFPVixFQUFFUyxRQUFVLEtBQzlCcUIsRUFBSzVCLE1BQU1VLElBQU1aLEVBQUVXLFFBQVUsSUFBSSxFQUcvQmMsRUFBUSxLQUNWSyxFQUFLNUIsTUFBTVEsS0FBTyxNQUNsQm9CLEVBQUs1QixNQUFNVSxJQUFNLE1BQ2pCa0IsRUFBSzVCLE1BQU11QyxRQUFVLE1BQU0sRUFHL0IxRixFQUFROEQsaUJBQWlCLFlBQWFkLEdBQ3RDaEQsRUFBUThELGlCQUFpQixjQUFlYSxHQUN4Q0ksRUFBS2pCLGlCQUFpQixRQUFTWSxHQUUvQmhFLE1BQUssRUFBVVUsSUFBSXBCLEVBQVMsQ0FBRStFLE9BQU1LLFNBQVFRLFVBQVcsQ0FBRTVDLFlBQVcyQixjQUFhRCxVQUNyRixDQUVBbEMsY0FBY3hDLEdBQ1YsTUFBTSxLQUFFK0UsRUFBSSxPQUFFSyxFQUFNLFVBQUVRLEdBQWNsRixNQUFLLEVBQVVzQixJQUFJaEMsSUFBWSxDQUFDLEVBRXBFLElBQUsrRSxJQUFTSyxJQUFXUSxFQUFXLE1BQU0sSUFBSTNCLE1BQU0sb0NBRXBEakUsRUFBUWtFLG9CQUFvQixZQUFhMEIsRUFBVTVDLFdBQ25EaEQsRUFBUWtFLG9CQUFvQixjQUFlMEIsRUFBVWpCLGFBQ3JESSxFQUFLYixvQkFBb0IsUUFBUzBCLEVBQVVsQixPQUU1QzlELE1BQU1JLEtBQUtvRSxHQUFRbEUsU0FBUSxFQUFFb0UsRUFBS3RCLEtBQzlCZSxFQUFLUSxjQUFjLElBQU1ELEdBQU1wQixvQkFBb0IsUUFBU0YsS0FHaEVlLEVBQUtjLFFBQ1QseUZDdkZHLE1BQU1DLFVBQWUsRUFBQS9GLFFBQ2ZDLFFBRVRNLGFBQVksRUFBRUMsRUFBQyxFQUFFQyxHQUFnQyxDQUFFRCxFQUFHLEVBQUdDLEVBQUcsSUFDeERDLFFBRUFDLEtBQUtWLFFBQVUsRUFBQVcsSUFBSSwwQ0FFbkJELEtBQUtvQixLQUFLdkIsRUFBR0MsRUFDakIsaUNDVEcsU0FBU0csS0FBUW9GLEdBQ3BCLE1BQU9DLEtBQWFDLEdBQVVGLEVBRXhCcEYsRUFDa0IsaUJBQWJxRixFQUF3QkEsRUFBV0EsRUFBU0UsUUFBTyxDQUFDdkYsRUFBTXdGLEVBQU0xRSxJQUFNZCxFQUFPd0YsRUFBT0YsRUFBT3hFLElBQU0sSUFBSSxJQUVoSCxPQUFPLElBQUkyRSxXQUFZQyxnQkFBZ0IxRixFQUFNLGFBQWE0QyxLQUFLK0MsV0FBVyxFQUM5RSwwQ0FFTyxNQUFldkcsRUFDbEJ5QyxZQUF1QjRCLFNBQVNtQixjQUFjLGlCQUk5Q3pELEtBQUt2QixFQUFXQyxHQUNaRSxLQUFLVixRQUFRbUQsTUFBTVEsS0FBT3BELEVBQUksS0FDOUJHLEtBQUtWLFFBQVFtRCxNQUFNVSxJQUFNckQsRUFBSSxJQUNqQyxDQUVBdUIsU0FDSWhDLEVBQVF3RyxLQUFLQyxPQUFPOUYsS0FBS1YsUUFDN0IsQ0FFQW9DLFNBQ0kxQixLQUFLVixRQUFRNkYsUUFDakIsbUhDekJHLE1BQU1ZLEVBQ1l6RixLQUE0QjBGLEdBQWpEcEcsWUFBcUJVLEVBQTRCMEYsR0FBNUIsS0FBQTFGLEtBQUFBLEVBQTRCLEtBQUEwRixHQUFBQSxFQUM3QyxJQUFJckYsa0JBQWlCLEtBQ2pCcUYsRUFBR2hGLFVBQVVHLE9BQU8sWUFBYWIsRUFBS1UsVUFBVUMsU0FBUyxhQUFhLElBQ3ZFTSxRQUFRakIsRUFBTSxDQUFFa0IsZ0JBQWlCLENBQUMsU0FBVUMsWUFBWSxHQUMvRCxFQUdHLE1BQU13RSxFQUNUbkUsYUFBZSxHQUVmQSxnQkFDSSxNQUFNb0UsR0FBTSxJQUFBQyxhQUVabkcsS0FBS29HLE1BQU01RixTQUFTNkYsSUFDaEIsTUFBTS9GLEVBQU8rRixFQUFLL0YsS0FBS3NDLHdCQUNqQm9ELEVBQUtLLEVBQUtMLEdBQUdwRCx3QkFFbkJzRCxFQUFJSSxZQUFjRCxFQUFLL0YsS0FBS1UsVUFBVUMsU0FBUyxhQUFlLFVBQVksVUFFMUVpRixFQUFJSyxVQUFZLEVBRWhCTCxFQUFJTSxTQUFXLFFBRWZOLEVBQUlPLFlBQ0pQLEVBQUlRLE9BQU9wRyxFQUFLVCxFQUFJUyxFQUFLcUcsTUFBUSxFQUFHckcsRUFBS1IsRUFBSVEsRUFBS3NHLE9BQVMsR0FDM0RWLEVBQUlXLE9BQU9iLEVBQUduRyxFQUFJbUcsRUFBR1csTUFBUSxFQUFHWCxFQUFHbEcsRUFBSWtHLEVBQUdZLE9BQVMsR0FDbkRWLEVBQUlZLFlBQ0paLEVBQUlhLFFBQVEsR0FFcEIsZ0VDaENKLE1BQU1iLEVBQU14QyxTQUFTbUIsY0FBYyxVQUFXbUMsV0FBVyxNQUVsRCxTQUFTYixJQUlaLE9BSEFELEVBQUllLE9BQU9OLE1BQVEvQyxPQUFPc0QsV0FDMUJoQixFQUFJZSxPQUFPTCxPQUFTaEQsT0FBT3VELFlBRXBCakIsQ0FDWCxrR0NMTyxNQUFla0IsRUFDVC9HLEtBRUFkLE9BQ0FDLFFBRVRJLFlBQVlTLEVBQWNkLEVBQVdDLEdBQ2pDUSxLQUFLSyxLQUFPQSxFQUNaTCxLQUFLVCxPQUFTQSxFQUNkUyxLQUFLUixRQUFVQSxDQUNuQixDQUlBcUIsU0FBU3RCLEdBQ0wsT0FBT1MsS0FBS2tCLE9BQU8zQixFQUN2QixFQUdHLE1BQU04SCxVQUFnQkQsRUFDekJ4SCxjQUNJRyxNQUFNLE1BQU8sRUFBRyxFQUNwQixDQUVBbUIsUUFBUW9HLEVBQUdDLElBQ1AsTUFBTyxDQUFDRCxHQUFLQyxFQUNqQixFQUdHLE1BQU1DLFVBQWVKLEVBQ3hCeEgsY0FDSUcsTUFBTSxLQUFNLEVBQUcsRUFDbkIsQ0FFQW1CLFFBQVFvRyxFQUFHQyxJQUNQLE1BQU8sQ0FBQ0QsR0FBS0MsRUFDakIsRUFHRyxNQUFNRSxVQUFnQkwsRUFDekJ4SCxjQUNJRyxNQUFNLE1BQU8sRUFBRyxFQUNwQixDQUVBbUIsUUFBUXdHLElBQ0osTUFBTyxFQUFFQSxFQUNiLEtDL0NBQyxFQUEyQixDQUFDLEVBR2hDLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUI5RixJQUFqQitGLEVBQ0gsT0FBT0EsRUFBYUMsUUFHckIsSUFBSUMsRUFBU0wsRUFBeUJFLEdBQVksQ0FHakRFLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CSixHQUFVRyxFQUFRQSxFQUFPRCxRQUFTSCxHQUcvQ0ksRUFBT0QsT0FDZixDQ3JCQUgsRUFBb0JNLEVBQUksQ0FBQ0gsRUFBU0ksS0FDakMsSUFBSSxJQUFJdkQsS0FBT3VELEVBQ1hQLEVBQW9CakcsRUFBRXdHLEVBQVl2RCxLQUFTZ0QsRUFBb0JqRyxFQUFFb0csRUFBU25ELElBQzVFTCxPQUFPNkQsZUFBZUwsRUFBU25ELEVBQUssQ0FBRXlELFlBQVksRUFBTS9HLElBQUs2RyxFQUFXdkQsSUFFMUUsRUNORGdELEVBQW9CakcsRUFBSSxDQUFDMkcsRUFBS0MsSUFBVWhFLE9BQU9pRSxVQUFVQyxlQUFlMUQsS0FBS3VELEVBQUtDLEdDQ2xGWCxFQUFvQmMsRUFBS1gsSUFDSCxvQkFBWFksUUFBMEJBLE9BQU9DLGFBQzFDckUsT0FBTzZELGVBQWVMLEVBQVNZLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RHRFLE9BQU82RCxlQUFlTCxFQUFTLGFBQWMsQ0FBRWMsT0FBTyxHQUFPLDJPQ0k5RCxNQUFNdkIsRUFBSSxJQUFJLEVBQUF2RCxNQUFNLENBQUVsRSxFQUFHLElBQUtDLEVBQUcsTUFDM0J5SCxFQUFJLElBQUksRUFBQXhELE1BQU0sQ0FBRWxFLEVBQUcsSUFBS0MsRUFBRyxNQUMzQmdKLEVBQUksSUFBSSxFQUFBMUosVUFBVSxJQUFJLEVBQUFpSSxRQUFXLENBQUV4SCxFQUFHLElBQUtDLEVBQUcsTUFDOUNvSSxFQUFJLElBQUksRUFBQTlDLE9BQU8sQ0FBRXZGLEVBQUcsSUFBS0MsRUFBRyxNQUU1QmlKLEVBQVMsSUFBSUMsSUFBSSxDQUFDMUIsRUFBR0MsRUFBR3VCLEVBQUdaLElBRWpDLEVBQUFyRyxnQkFBQSxTQUVBa0gsRUFBT3ZJLFNBQVNzSSxJQUNaQSxFQUFFekgsU0FFRXlILGFBQWEsRUFBQTFKLFdBQ2IsRUFBQXlDLGdCQUFBLE1BQXNCaUgsRUFBRXhKLFFBQVN3SixFQUFFeEosUUFBUXVGLGNBQTJCLHVCQUk5RSxFQUFBb0IsY0FBQSxXQUF5QixJQUFJLEVBQUFGLE9BQU91QixFQUFFaEksUUFBU3dKLEVBQUV2SixPQUFPLEtBQ3hELEVBQUEwRyxjQUFBLFdBQXlCLElBQUksRUFBQUYsT0FBT3dCLEVBQUVqSSxRQUFTd0osRUFBRXZKLE9BQU8sS0FDeEQsRUFBQTBHLGNBQUEsV0FBeUIsSUFBSSxFQUFBRixPQUFPK0MsRUFBRXRKLFFBQVEsR0FBSTBJLEVBQUU1SSxVQUVwRCxFQUFBNkUsWUFBQSxJQUFnQixFQUFBOUUsUUFBQSxLQUFjLENBQzFCLENBQ0ksY0FBZSxDQUNYb0YsTUFBTyxjQUNQSyxTQUFVLFNBR2xCLENBQ0ksWUFBYSxDQUNUTCxNQUFPLFlBQ1BLLFNBQVUsUUFFZCxhQUFjLENBQ1ZMLE1BQU8sYUFDUEssU0FBVSxTQUdsQixDQUNJLFdBQVksQ0FDUkwsTUFBTyx3QkFDUEssU0FBVSxTQUdsQixDQUNJLFVBQVcsQ0FDUEwsTUFBTyxlQUNQSyxTQUFVLFdBS3RCLFNBQVVtRSxJQUNOLEVBQUFoRCxjQUFBLFNBRUFpRCxzQkFBc0JELEVBQ3pCLENBSkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Aa2Vsc255L2dhdGVzaW0vLi9zcmMvQ29tcG9uZW50LnRzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS8uL3NyYy9EcmFnZ2luZ01hbmFnZXIudHMiLCJ3ZWJwYWNrOi8vQGtlbHNueS9nYXRlc2ltLy4vc3JjL0lucHV0LnRzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS8uL3NyYy9NZW51TWFuYWdlci50cyIsIndlYnBhY2s6Ly9Aa2Vsc255L2dhdGVzaW0vLi9zcmMvT3V0cHV0LnRzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS8uL3NyYy9SZWlmaWVkLnRzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS8uL3NyYy9XaXJpbmdNYW5hZ2VyLnRzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS8uL3NyYy9jYW52YXMudHMiLCJ3ZWJwYWNrOi8vQGtlbHNueS9nYXRlc2ltLy4vc3JjL2NoaXBzLnRzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9Aa2Vsc255L2dhdGVzaW0vd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL0BrZWxzbnkvZ2F0ZXNpbS8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGlwIH0gZnJvbSBcIi4vY2hpcHNcIjtcbmltcG9ydCB7IGh0bWwsIFJlaWZpZWQgfSBmcm9tIFwiLi9SZWlmaWVkXCI7XG5cbmV4cG9ydCBjbGFzcyBDb21wb25lbnQ8SSBleHRlbmRzIG51bWJlciwgTyBleHRlbmRzIG51bWJlcj4gZXh0ZW5kcyBSZWlmaWVkIHtcbiAgICByZWFkb25seSBlbGVtZW50O1xuXG4gICAgcmVhZG9ubHkgaW5wdXRzID0gW10gYXMgSFRNTEJ1dHRvbkVsZW1lbnRbXTtcbiAgICByZWFkb25seSBvdXRwdXRzID0gW10gYXMgSFRNTEJ1dHRvbkVsZW1lbnRbXTtcblxuICAgIHJlYWRvbmx5IG9ic2VydmVycyA9IG5ldyBNYXAoKTtcblxuICAgIHJlYWRvbmx5IGNoaXA6IENoaXA8SSwgTz47XG5cbiAgICBjb25zdHJ1Y3RvcihjaGlwOiBDaGlwPEksIE8+LCB7IHgsIHkgfTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9ID0geyB4OiAwLCB5OiAwIH0pIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmNoaXAgPSBjaGlwO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGh0bWxgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29tcG9uZW50XCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbXBvbmVudC1pbnB1dHNcIj5cbiAgICAgICAgICAgICAgICAgICAgJHtBcnJheSh0aGlzLmNoaXAuaW5wdXRzKS5maWxsKCc8YnV0dG9uIGNsYXNzPVwiY29tcG9uZW50LWlucHV0LWJ1dHRvblwiPkk8L2J1dHRvbj4nKS5qb2luKFwiXCIpfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzPVwiY29tcG9uZW50LW5hbWVcIj4ke3RoaXMuY2hpcC5uYW1lfTwvcD5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29tcG9uZW50LW91dHB1dHNcIj5cbiAgICAgICAgICAgICAgICAgICAgJHtBcnJheSh0aGlzLmNoaXAub3V0cHV0cykuZmlsbCgnPGJ1dHRvbiBjbGFzcz1cImNvbXBvbmVudC1vdXRwdXQtYnV0dG9uXCI+TzwvYnV0dG9uPicpLmpvaW4oXCJcIil9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcblxuICAgICAgICB0aGlzLmlucHV0cyA9IEFycmF5LmZyb20odGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY29tcG9uZW50LWlucHV0LWJ1dHRvblwiKSk7XG4gICAgICAgIHRoaXMub3V0cHV0cyA9IEFycmF5LmZyb20odGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY29tcG9uZW50LW91dHB1dC1idXR0b25cIikpO1xuXG4gICAgICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PlxuICAgICAgICAgICAgdGhpcy5vYnNlcnZlcnMuc2V0KFxuICAgICAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAgICAgIG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0ID0gdGhpcy5jaGlwLmV2YWx1YXRlKHRoaXMuaW5wdXRzLm1hcCgoaSkgPT4gaS5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmF0ZWRcIikpKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLm91dHB1dHMuZm9yRWFjaCgob3V0cHV0LCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2YXRlZFwiLCBvdXRbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMubW92ZSh4LCB5KTtcbiAgICB9XG5cbiAgICBhdHRhY2goKSB7XG4gICAgICAgIHN1cGVyLmF0dGFjaCgpO1xuXG4gICAgICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9ic2VydmVycy5nZXQoaW5wdXQpLm9ic2VydmUoaW5wdXQsIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFtcImNsYXNzXCJdLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZGV0YWNoKCkge1xuICAgICAgICBzdXBlci5kZXRhY2goKTtcblxuICAgICAgICB0aGlzLm9ic2VydmVycy5mb3JFYWNoKChvKSA9PiBvLmRpc2Nvbm5lY3QoKSk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIERyYWdnaW5nTWFuYWdlciB7XG4gICAgc3RhdGljICNkcmFnZ2VkID0gdW5kZWZpbmVkIGFzIEhUTUxFbGVtZW50IHwgdW5kZWZpbmVkO1xuXG4gICAgc3RhdGljICNtb3VzZSA9IHtcbiAgICAgICAgeDogLTEsXG4gICAgICAgIHk6IC0xLFxuICAgICAgICBveDogLTEsXG4gICAgICAgIG95OiAtMSxcbiAgICAgICAgZG93bjogZmFsc2UsXG4gICAgfTtcblxuICAgIHN0YXRpYyAjd2F0Y2hlZCA9IG5ldyBNYXAoKTtcblxuICAgIHN0YXRpYyB3YXRjaChlbGVtZW50OiBIVE1MRWxlbWVudCwgdGFyZ2V0ID0gZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50LmRhdGFzZXQud2F0Y2hlZCA9IFwidHJ1ZVwiO1xuXG4gICAgICAgIGNvbnN0IG1vdXNlZG93biA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLiNkcmFnZ2VkID0gZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy4jZHJhZ2dlZC5kYXRhc2V0LmRyYWdnZWQgPSBcInRydWVcIjtcblxuICAgICAgICAgICAgdGhpcy4jZHJhZ2dlZC5zdHlsZS5jdXJzb3IgPSBcImdyYWJiaW5nXCI7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLiNkcmFnZ2VkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgICAgICBjb25zdCBib2R5ID0gdGhpcy4jZHJhZ2dlZC5wYXJlbnRFbGVtZW50Py5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA/PyBuZXcgRE9NUmVjdCgpO1xuXG4gICAgICAgICAgICB0aGlzLiNtb3VzZS5veCA9IGUuY2xpZW50WCAtIHJlY3QubGVmdCArIGJvZHkubGVmdDtcbiAgICAgICAgICAgIHRoaXMuI21vdXNlLm95ID0gZS5jbGllbnRZIC0gcmVjdC50b3AgKyBib2R5LnRvcDtcbiAgICAgICAgfTtcblxuICAgICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBtb3VzZWRvd24sIHsgY2FwdHVyZTogdHJ1ZSB9KTtcblxuICAgICAgICB0aGlzLiN3YXRjaGVkLnNldCh0YXJnZXQsIG1vdXNlZG93bik7XG4gICAgfVxuXG4gICAgc3RhdGljIGZvcmdldChlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMuI3dhdGNoZWQuZ2V0KGVsZW1lbnQpO1xuXG4gICAgICAgIGlmICghbGlzdGVuZXIpIHRocm93IG5ldyBFcnJvcihgRWxlbWVudCBpcyBub3QgY3VycmVudGx5IGJlaW5nIHdhdGNoZWQuYCk7XG5cbiAgICAgICAgZGVsZXRlIGVsZW1lbnQuZGF0YXNldC53YXRjaGVkO1xuXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBsaXN0ZW5lciwgeyBjYXB0dXJlOiB0cnVlIH0pO1xuXG4gICAgICAgIHRoaXMuI3dhdGNoZWQuZGVsZXRlKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIHN0YXRpYyBsaXN0ZW4oKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm1vdXNlbW92ZSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMubW91c2Vkb3duKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMubW91c2V1cCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGRlYWZlbigpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMubW91c2Vtb3ZlKTtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5tb3VzZWRvd24pO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5tb3VzZXVwKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgbW91c2Vtb3ZlKGU6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgdGhpcy4jbW91c2UueCA9IGUuY2xpZW50WDtcbiAgICAgICAgdGhpcy4jbW91c2UueSA9IGUuY2xpZW50WTtcblxuICAgICAgICBpZiAodGhpcy4jZHJhZ2dlZCkge1xuICAgICAgICAgICAgdGhpcy4jZHJhZ2dlZC5zdHlsZS5sZWZ0ID0gdGhpcy4jbW91c2UueCAtIHRoaXMuI21vdXNlLm94ICsgXCJweFwiO1xuICAgICAgICAgICAgdGhpcy4jZHJhZ2dlZC5zdHlsZS50b3AgPSB0aGlzLiNtb3VzZS55IC0gdGhpcy4jbW91c2Uub3kgKyBcInB4XCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgbW91c2Vkb3duKGU6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgdGhpcy4jbW91c2UuZG93biA9IHRydWU7XG4gICAgfVxuXG4gICAgc3RhdGljIG1vdXNldXAoKSB7XG4gICAgICAgIGlmICh0aGlzLiNkcmFnZ2VkKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignW2RhdGEtZHJhZ2dlZD1cInRydWVcIl0nKS5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGUuZGF0YXNldC5kcmFnZ2VkO1xuXG4gICAgICAgICAgICAgICAgZS5zdHlsZS5jdXJzb3IgPSBcIlwiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiNtb3VzZS5kb3duID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy4jbW91c2UueCA9IC0xO1xuICAgICAgICB0aGlzLiNtb3VzZS55ID0gLTE7XG5cbiAgICAgICAgdGhpcy4jbW91c2Uub3ggPSAtMTtcbiAgICAgICAgdGhpcy4jbW91c2Uub3kgPSAtMTtcblxuICAgICAgICB0aGlzLiNkcmFnZ2VkID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHN0YXRpYyB7XG4gICAgICAgIHRoaXMubW91c2Vtb3ZlID0gdGhpcy5tb3VzZW1vdmUuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5tb3VzZWRvd24gPSB0aGlzLm1vdXNlZG93bi5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm1vdXNldXAgPSB0aGlzLm1vdXNldXAuYmluZCh0aGlzKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBodG1sLCBSZWlmaWVkIH0gZnJvbSBcIi4vUmVpZmllZFwiO1xuXG5leHBvcnQgY2xhc3MgSW5wdXQgZXh0ZW5kcyBSZWlmaWVkIHtcbiAgICByZWFkb25seSBlbGVtZW50O1xuXG4gICAgY29uc3RydWN0b3IoeyB4LCB5IH06IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfSA9IHsgeDogMCwgeTogMCB9KSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gaHRtbGA8YnV0dG9uIGNsYXNzPVwiYm9hcmQtaW5wdXRcIj5JPC9idXR0b24+YDtcblxuICAgICAgICB0aGlzLm1vdmUoeCwgeSk7XG4gICAgfVxuXG4gICAgY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKFwiYWN0aXZhdGVkXCIpO1xuICAgIH07XG5cbiAgICBjb250ZXh0bWVudSA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2YXRlZFwiKTtcbiAgICB9O1xuXG4gICAgYXR0YWNoKCkge1xuICAgICAgICBzdXBlci5hdHRhY2goKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xpY2spO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIHRoaXMuY29udGV4dG1lbnUpO1xuICAgIH1cblxuICAgIGRldGFjaCgpIHtcbiAgICAgICAgc3VwZXIuZGV0YWNoKCk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmNsaWNrKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBodG1sIH0gZnJvbSBcIi4vUmVpZmllZFwiO1xuXG5leHBvcnQgdHlwZSBNZW51TWFuYWdlckNvbnRleHQgPSB7XG4gICAgbWVudTogSFRNTEVsZW1lbnQ7XG4gICAgY2xpY2tzOiBNYXA8c3RyaW5nLCAoKSA9PiB2b2lkPjtcbiAgICBsaXN0ZW5lcnM6IHtcbiAgICAgICAgbW91c2Vkb3duOiAoZTogTW91c2VFdmVudCkgPT4gdm9pZDtcbiAgICAgICAgY29udGV4dG1lbnU6IChlOiBNb3VzZUV2ZW50KSA9PiB2b2lkO1xuICAgICAgICBjbGljazogKGU6IE1vdXNlRXZlbnQpID0+IHZvaWQ7XG4gICAgfTtcbn07XG5cbmV4cG9ydCBjbGFzcyBNZW51TWFuYWdlciB7XG4gICAgc3RhdGljICNlbGVtZW50cyA9IG5ldyBNYXA8SFRNTEVsZW1lbnQsIE1lbnVNYW5hZ2VyQ29udGV4dD4oKTtcblxuICAgIHN0YXRpYyB1c2UoZWxlbWVudDogSFRNTEVsZW1lbnQsIGFjdGlvbnM6IFJlY29yZDxzdHJpbmcsIHsgbGFiZWw6IHN0cmluZzsgY2FsbGJhY2s6ICgpID0+IHZvaWQgfT5bXSkge1xuICAgICAgICBjb25zdCBtZW51ID0gaHRtbGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250ZXh0bWVudVwiPlxuICAgICAgICAgICAgICAgICR7YWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICAubWFwKChyZWNvcmQpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhyZWNvcmQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoW25hbWUsIHsgbGFiZWwgfV0pID0+IGA8YnV0dG9uIGNsYXNzPVwiJHtuYW1lfVwiPiR7bGFiZWx9PC9idXR0b24+YClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuam9pbihcIlwiKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIC5qb2luKCc8ZGl2IGNsYXNzPVwiYnJcIj48L2Rpdj4nKX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuXG4gICAgICAgIGNvbnN0IGNsaWNrcyA9IG5ldyBNYXAoKTtcblxuICAgICAgICBhY3Rpb25zLmZvckVhY2goKHJlY29yZCkgPT4ge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocmVjb3JkKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVjb3JkW2tleV0uY2FsbGJhY2suY2FsbCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBtZW51LnF1ZXJ5U2VsZWN0b3I8SFRNTEVsZW1lbnQ+KFwiLlwiICsga2V5KSEuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsaWNrKTtcblxuICAgICAgICAgICAgICAgIGNsaWNrcy5zZXQoa2V5LCBjbGlja3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1lbnUuc3R5bGUubGVmdCA9IFwiMHB4XCI7XG4gICAgICAgIG1lbnUuc3R5bGUudG9wID0gXCIwcHhcIjtcbiAgICAgICAgbWVudS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtZW51KTtcblxuICAgICAgICBjb25zdCBtb3VzZWRvd24gPSAoKSA9PiB7XG4gICAgICAgICAgICBtZW51LnN0eWxlLmxlZnQgPSBcIjBweFwiO1xuICAgICAgICAgICAgbWVudS5zdHlsZS50b3AgPSBcIjBweFwiO1xuICAgICAgICAgICAgbWVudS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgY29udGV4dG1lbnUgPSAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBtZW51LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgICAgICAgICAgbWVudS5zdHlsZS5sZWZ0ID0gZS5jbGllbnRYICsgXCJweFwiO1xuICAgICAgICAgICAgbWVudS5zdHlsZS50b3AgPSBlLmNsaWVudFkgKyBcInB4XCI7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICBtZW51LnN0eWxlLmxlZnQgPSBcIjBweFwiO1xuICAgICAgICAgICAgbWVudS5zdHlsZS50b3AgPSBcIjBweFwiO1xuICAgICAgICAgICAgbWVudS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH07XG5cbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIG1vdXNlZG93bik7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGNvbnRleHRtZW51KTtcbiAgICAgICAgbWVudS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xpY2spO1xuXG4gICAgICAgIHRoaXMuI2VsZW1lbnRzLnNldChlbGVtZW50LCB7IG1lbnUsIGNsaWNrcywgbGlzdGVuZXJzOiB7IG1vdXNlZG93biwgY29udGV4dG1lbnUsIGNsaWNrIH0gfSk7XG4gICAgfVxuXG4gICAgc3RhdGljIHJlbW92ZShlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgICAgICBjb25zdCB7IG1lbnUsIGNsaWNrcywgbGlzdGVuZXJzIH0gPSB0aGlzLiNlbGVtZW50cy5nZXQoZWxlbWVudCkgPz8ge307XG5cbiAgICAgICAgaWYgKCFtZW51IHx8ICFjbGlja3MgfHwgIWxpc3RlbmVycykgdGhyb3cgbmV3IEVycm9yKGBFbGVtZW50cyBhcmUgbm90IGJlaW5nIGFmZmVjdGVkLmApO1xuXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBsaXN0ZW5lcnMubW91c2Vkb3duKTtcbiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgbGlzdGVuZXJzLmNvbnRleHRtZW51KTtcbiAgICAgICAgbWVudS5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbGlzdGVuZXJzLmNsaWNrKTtcblxuICAgICAgICBBcnJheS5mcm9tKGNsaWNrcykuZm9yRWFjaCgoW2tleSwgbGlzdGVuZXJdKSA9PlxuICAgICAgICAgICAgbWVudS5xdWVyeVNlbGVjdG9yKFwiLlwiICsga2V5KSEucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGxpc3RlbmVyKVxuICAgICAgICApO1xuXG4gICAgICAgIG1lbnUucmVtb3ZlKCk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgaHRtbCwgUmVpZmllZCB9IGZyb20gXCIuL1JlaWZpZWRcIjtcblxuZXhwb3J0IGNsYXNzIE91dHB1dCBleHRlbmRzIFJlaWZpZWQge1xuICAgIHJlYWRvbmx5IGVsZW1lbnQ7XG5cbiAgICBjb25zdHJ1Y3Rvcih7IHgsIHkgfTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9ID0geyB4OiAwLCB5OiAwIH0pIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBodG1sYDxidXR0b24gY2xhc3M9XCJib2FyZC1vdXRwdXRcIj5PPC9idXR0b24+YDtcblxuICAgICAgICB0aGlzLm1vdmUoeCwgeSk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGZ1bmN0aW9uIGh0bWwodGVtcGxhdGU6IFRlbXBsYXRlU3RyaW5nc0FycmF5LCAuLi52YWx1ZXM6IHVua25vd25bXSk6IEhUTUxFbGVtZW50O1xuZXhwb3J0IGZ1bmN0aW9uIGh0bWwoaHRtbDogc3RyaW5nKTogSFRNTEVsZW1lbnQ7XG5leHBvcnQgZnVuY3Rpb24gaHRtbCguLi5hcmdzOiBbc3RyaW5nXSB8IFtUZW1wbGF0ZVN0cmluZ3NBcnJheSwgLi4udW5rbm93bltdXSkge1xuICAgIGNvbnN0IFt0ZW1wbGF0ZSwgLi4udmFsdWVzXSA9IGFyZ3M7XG5cbiAgICBjb25zdCBodG1sID1cbiAgICAgICAgdHlwZW9mIHRlbXBsYXRlID09PSBcInN0cmluZ1wiID8gdGVtcGxhdGUgOiB0ZW1wbGF0ZS5yZWR1Y2UoKGh0bWwsIHRleHQsIGkpID0+IGh0bWwgKyB0ZXh0ICsgdmFsdWVzW2ldID8/IFwiXCIsIFwiXCIpO1xuXG4gICAgcmV0dXJuIG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgXCJ0ZXh0L2h0bWxcIikuYm9keS5jaGlsZE5vZGVzWzBdO1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUmVpZmllZCB7XG4gICAgc3RhdGljIHJlYWRvbmx5IHJvb3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlaWZpZWQtcm9vdFwiKSBhcyBIVE1MRWxlbWVudDtcblxuICAgIGFic3RyYWN0IHJlYWRvbmx5IGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuXG4gICAgbW92ZSh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHggKyBcInB4XCI7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPSB5ICsgXCJweFwiO1xuICAgIH1cblxuICAgIGF0dGFjaCgpIHtcbiAgICAgICAgUmVpZmllZC5yb290LmFwcGVuZCh0aGlzLmVsZW1lbnQpO1xuICAgIH1cblxuICAgIGRldGFjaCgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IHVzZUNhbnZhcyB9IGZyb20gXCIuL2NhbnZhc1wiO1xuXG5leHBvcnQgY2xhc3MgV2lyaW5nIHtcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSBmcm9tOiBIVE1MRWxlbWVudCwgcmVhZG9ubHkgdG86IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICAgICAgICAgIHRvLmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmF0ZWRcIiwgZnJvbS5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmF0ZWRcIikpO1xuICAgICAgICB9KS5vYnNlcnZlKGZyb20sIHsgYXR0cmlidXRlRmlsdGVyOiBbXCJjbGFzc1wiXSwgYXR0cmlidXRlczogdHJ1ZSB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBXaXJpbmdNYW5hZ2VyIHtcbiAgICBzdGF0aWMgd2lyZXMgPSBbXSBhcyBXaXJpbmdbXTtcblxuICAgIHN0YXRpYyByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGN0eCA9IHVzZUNhbnZhcygpO1xuXG4gICAgICAgIHRoaXMud2lyZXMuZm9yRWFjaCgod2lyZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZnJvbSA9IHdpcmUuZnJvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIGNvbnN0IHRvID0gd2lyZS50by5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gd2lyZS5mcm9tLmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2YXRlZFwiKSA/IFwiI2ZmMjYyNlwiIDogXCIjZGVkZWRlXCI7XG5cbiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSA1O1xuXG4gICAgICAgICAgICBjdHgubGluZUpvaW4gPSBcInJvdW5kXCI7XG5cbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oZnJvbS54ICsgZnJvbS53aWR0aCAvIDIsIGZyb20ueSArIGZyb20uaGVpZ2h0IC8gMik7XG4gICAgICAgICAgICBjdHgubGluZVRvKHRvLnggKyB0by53aWR0aCAvIDIsIHRvLnkgKyB0by5oZWlnaHQgLyAyKTtcbiAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiY29uc3QgY3R4ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKSEuZ2V0Q29udGV4dChcIjJkXCIpITtcblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUNhbnZhcygpIHtcbiAgICBjdHguY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgY3R4LmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICByZXR1cm4gY3R4O1xufVxuIiwiaW1wb3J0IHsgQm9vbGVhblR1cGxlIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENoaXA8SSBleHRlbmRzIG51bWJlciwgTyBleHRlbmRzIG51bWJlcj4ge1xuICAgIHJlYWRvbmx5IG5hbWU7XG5cbiAgICByZWFkb25seSBpbnB1dHM7XG4gICAgcmVhZG9ubHkgb3V0cHV0cztcblxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgaW5wdXRzOiBJLCBvdXRwdXRzOiBPKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuICAgICAgICB0aGlzLm91dHB1dHMgPSBvdXRwdXRzO1xuICAgIH1cblxuICAgIGFic3RyYWN0IG91dHB1dChpbnB1dHM6IEJvb2xlYW5UdXBsZTxJPik6IEJvb2xlYW5UdXBsZTxPPjtcblxuICAgIGV2YWx1YXRlKGlucHV0czogYm9vbGVhbltdKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm91dHB1dChpbnB1dHMgYXMgQm9vbGVhblR1cGxlPEksIFtdPikgYXMgYm9vbGVhbltdO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFuZEdhdGUgZXh0ZW5kcyBDaGlwPDIsIDE+IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoXCJBTkRcIiwgMiwgMSk7XG4gICAgfVxuXG4gICAgb3V0cHV0KFthLCBiXTogW2Jvb2xlYW4sIGJvb2xlYW5dKTogW2Jvb2xlYW5dIHtcbiAgICAgICAgcmV0dXJuIFthICYmIGJdO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIE9yR2F0ZSBleHRlbmRzIENoaXA8MiwgMT4ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihcIk9SXCIsIDIsIDEpO1xuICAgIH1cblxuICAgIG91dHB1dChbYSwgYl06IFtib29sZWFuLCBib29sZWFuXSk6IFtib29sZWFuXSB7XG4gICAgICAgIHJldHVybiBbYSB8fCBiXTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOb3RHYXRlIGV4dGVuZHMgQ2hpcDwxLCAxPiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKFwiTk9UXCIsIDEsIDEpO1xuICAgIH1cblxuICAgIG91dHB1dChbbl06IFtib29sZWFuXSk6IFtib29sZWFuXSB7XG4gICAgICAgIHJldHVybiBbIW5dO1xuICAgIH1cbn1cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgQW5kR2F0ZSB9IGZyb20gXCIuL2NoaXBzXCI7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiLi9Db21wb25lbnRcIjtcbmltcG9ydCB7IERyYWdnaW5nTWFuYWdlciB9IGZyb20gXCIuL0RyYWdnaW5nTWFuYWdlclwiO1xuaW1wb3J0IHsgSW5wdXQgfSBmcm9tIFwiLi9JbnB1dFwiO1xuaW1wb3J0IHsgTWVudU1hbmFnZXIgfSBmcm9tIFwiLi9NZW51TWFuYWdlclwiO1xuaW1wb3J0IHsgT3V0cHV0IH0gZnJvbSBcIi4vT3V0cHV0XCI7XG5pbXBvcnQgeyBSZWlmaWVkIH0gZnJvbSBcIi4vUmVpZmllZFwiO1xuaW1wb3J0IHsgV2lyaW5nLCBXaXJpbmdNYW5hZ2VyIH0gZnJvbSBcIi4vV2lyaW5nTWFuYWdlclwiO1xuXG5jb25zdCBhID0gbmV3IElucHV0KHsgeDogMTAwLCB5OiAxMDAgfSk7XG5jb25zdCBiID0gbmV3IElucHV0KHsgeDogMTAwLCB5OiAyMDAgfSk7XG5jb25zdCBjID0gbmV3IENvbXBvbmVudChuZXcgQW5kR2F0ZSgpLCB7IHg6IDMwMCwgeTogMTUwIH0pO1xuY29uc3QgZCA9IG5ldyBPdXRwdXQoeyB4OiA1MDAsIHk6IDE1MCB9KTtcblxuY29uc3QgYWN0aXZlID0gbmV3IFNldChbYSwgYiwgYywgZF0pO1xuXG5EcmFnZ2luZ01hbmFnZXIubGlzdGVuKCk7XG5cbmFjdGl2ZS5mb3JFYWNoKChjKSA9PiB7XG4gICAgYy5hdHRhY2goKTtcblxuICAgIGlmIChjIGluc3RhbmNlb2YgQ29tcG9uZW50KSB7XG4gICAgICAgIERyYWdnaW5nTWFuYWdlci53YXRjaChjLmVsZW1lbnQsIGMuZWxlbWVudC5xdWVyeVNlbGVjdG9yPEhUTUxFbGVtZW50PihcIi5jb21wb25lbnQtbmFtZVwiKSEpO1xuICAgIH1cbn0pO1xuXG5XaXJpbmdNYW5hZ2VyLndpcmVzLnB1c2gobmV3IFdpcmluZyhhLmVsZW1lbnQsIGMuaW5wdXRzWzBdKSk7XG5XaXJpbmdNYW5hZ2VyLndpcmVzLnB1c2gobmV3IFdpcmluZyhiLmVsZW1lbnQsIGMuaW5wdXRzWzFdKSk7XG5XaXJpbmdNYW5hZ2VyLndpcmVzLnB1c2gobmV3IFdpcmluZyhjLm91dHB1dHNbMF0sIGQuZWxlbWVudCkpO1xuXG5NZW51TWFuYWdlci51c2UoUmVpZmllZC5yb290LCBbXG4gICAge1xuICAgICAgICBcImluc2VydC1jaGlwXCI6IHtcbiAgICAgICAgICAgIGxhYmVsOiBcIkluc2VydCBjaGlwXCIsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge30sXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwibmV3LWlucHV0XCI6IHtcbiAgICAgICAgICAgIGxhYmVsOiBcIk5ldyBpbnB1dFwiLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHt9LFxuICAgICAgICB9LFxuICAgICAgICBcIm5ldy1vdXRwdXRcIjoge1xuICAgICAgICAgICAgbGFiZWw6IFwiTmV3IG91dHB1dFwiLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHt9LFxuICAgICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgICBcIm5ldy1jaGlwXCI6IHtcbiAgICAgICAgICAgIGxhYmVsOiBcIk5ldyBjaGlwIGZyb20gZGlhZ3JhbVwiLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHt9LFxuICAgICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgICBcInNhdmUtYXNcIjoge1xuICAgICAgICAgICAgbGFiZWw6IFwiU2F2ZSBhcyBmaWxlXCIsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge30sXG4gICAgICAgIH0sXG4gICAgfSxcbl0pO1xuXG4oZnVuY3Rpb24gbG9vcCgpIHtcbiAgICBXaXJpbmdNYW5hZ2VyLnJlbmRlcigpO1xuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xufSkoKTtcbiJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJSZWlmaWVkIiwiZWxlbWVudCIsImlucHV0cyIsIm91dHB1dHMiLCJvYnNlcnZlcnMiLCJNYXAiLCJjaGlwIiwiY29uc3RydWN0b3IiLCJ4IiwieSIsInN1cGVyIiwidGhpcyIsImh0bWwiLCJBcnJheSIsImZpbGwiLCJqb2luIiwibmFtZSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0Iiwic2V0IiwiTXV0YXRpb25PYnNlcnZlciIsIm91dCIsImV2YWx1YXRlIiwibWFwIiwiaSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwib3V0cHV0IiwidG9nZ2xlIiwibW92ZSIsImF0dGFjaCIsImdldCIsIm9ic2VydmUiLCJhdHRyaWJ1dGVGaWx0ZXIiLCJhdHRyaWJ1dGVzIiwiZGV0YWNoIiwibyIsImRpc2Nvbm5lY3QiLCJEcmFnZ2luZ01hbmFnZXIiLCJzdGF0aWMiLCJ1bmRlZmluZWQiLCJveCIsIm95IiwiZG93biIsInRhcmdldCIsImRhdGFzZXQiLCJ3YXRjaGVkIiwibW91c2Vkb3duIiwiZSIsImRyYWdnZWQiLCJzdHlsZSIsImN1cnNvciIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJib2R5IiwicGFyZW50RWxlbWVudCIsIkRPTVJlY3QiLCJjbGllbnRYIiwibGVmdCIsImNsaWVudFkiLCJ0b3AiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FwdHVyZSIsImxpc3RlbmVyIiwiRXJyb3IiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGVsZXRlIiwiZG9jdW1lbnQiLCJtb3VzZW1vdmUiLCJ3aW5kb3ciLCJtb3VzZXVwIiwiYmluZCIsIklucHV0IiwiY2xpY2siLCJjb250ZXh0bWVudSIsInByZXZlbnREZWZhdWx0IiwiTWVudU1hbmFnZXIiLCJhY3Rpb25zIiwibWVudSIsInJlY29yZCIsIk9iamVjdCIsImVudHJpZXMiLCJsYWJlbCIsImNsaWNrcyIsImtleXMiLCJrZXkiLCJxdWVyeVNlbGVjdG9yIiwiY2FsbGJhY2siLCJjYWxsIiwiZGlzcGxheSIsImFwcGVuZENoaWxkIiwibGlzdGVuZXJzIiwicmVtb3ZlIiwiT3V0cHV0IiwiYXJncyIsInRlbXBsYXRlIiwidmFsdWVzIiwicmVkdWNlIiwidGV4dCIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsImNoaWxkTm9kZXMiLCJyb290IiwiYXBwZW5kIiwiV2lyaW5nIiwidG8iLCJXaXJpbmdNYW5hZ2VyIiwiY3R4IiwidXNlQ2FudmFzIiwid2lyZXMiLCJ3aXJlIiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJsaW5lSm9pbiIsImJlZ2luUGF0aCIsIm1vdmVUbyIsIndpZHRoIiwiaGVpZ2h0IiwibGluZVRvIiwiY2xvc2VQYXRoIiwic3Ryb2tlIiwiZ2V0Q29udGV4dCIsImNhbnZhcyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsIkNoaXAiLCJBbmRHYXRlIiwiYSIsImIiLCJPckdhdGUiLCJOb3RHYXRlIiwibiIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsImMiLCJhY3RpdmUiLCJTZXQiLCJsb29wIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==